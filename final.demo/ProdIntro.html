<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品介紹</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="./spinbutton/js/jquery-1.4.4.min.js"></script>
    <script src="./spinbutton/js/jquery-spin.js"></script>
    <link href="css/prodintro.css" rel="stylesheet" type="text/css">
    <link rel="icon" href="images/cake51.png">




    <div id="mySidepanel" class="sidepanel">
        <a href="#" class="closebtn" onclick="closeNav()">×</a>
        <a href="Index.html">首頁</a>
        <button class="dropdown-btn">商品分類<i class="fa fa-caret-down"></i></button>
        <div class="dropdown-container">
            <a href="ProdList.html">所有商品</a>
            <a href="ProdList.html?cat=2">蛋糕</a>
            <a href="ProdList.html?cat=3">塔類</a>
            <a href="ProdList.html?cat=4">餅乾</a>
            <a href="ProdList.html?cat=5">常溫點心</a>
        </div>
        <a href="#">促銷活動</a>
        <a href="#">常見問題</a>
        <a href="#">關於我們</a>
    </div>

    <button class="openbtn" onclick="openNav()">☰ </button>

    <div class="img2-header">
        <div class="dropdown">
            <img onclick="myFunction()" class="dropbtn" src="images/images.png" width="45px" height="45"
                title="會員專區"></img>
            <div id="myDropdown" class="dropdown-content">

                <span onclick="document.getElementById('id01').style.display='block'"><a href="#"
                        style="padding: 12px 16px; ">登入</a></span>
                <span onclick="document.getElementById('id02').style.display='block'"><a href="#"
                        style="padding: 12px 16px; ">註冊</a></span>

                <a href="PersonalInfo.html">個人資料修改</a>
                <a href="#">訂單紀錄</a>
                <a href="#">登出</a>
            </div>
        </div>
    </div>

    <!-- 購物車 -->
    <div class="img1-header">
        <a href="ShopCart.html"><img src="images/shopcart2.png" width="50" height="50" title="購物車"> </a>
    </div>

    <!-- 會員登入 -->
    <div id="id01" class="modal">
        <form class="modal-content animate" style="width: 350px;" action="/action1_page.php" method="post">
            <div class="imgcontainer">
                <span onclick="document.getElementById('id01').style.display='none'" class="close"
                    title="Close Modal">&times;</span>
                <div class="contant02" style="font-size:25px;">會員登入</div>
            </div>

            <div class="container">
                <label for="uname"><b>帳號</b></label>
                <span class="ipt"><input type="text" placeholder="輸入帳號" name="uname" required></span>

                <label for="psw"><b>密碼</b></label>
                <span class="ipt"><input type="password" placeholder="輸入密碼" name="psw" required></span>

                <span class="btn02"><button type="submit" class="sign">登入</button></span>
                <label>
                    <span class="ipt"><input type="checkbox" checked="checked" name="remember">記住我的帳號</span>
                </label>
            </div>

            <div class="container" style="background-color:#dddd; ">
                <button type="button" onclick="document.getElementById('id01').style.display='none'"
                    class="cancelbtn">取消</button>
                <span onclick="document.getElementById('id01').style.display='none'; 
              document.getElementById('id02').style.display='block'" class="register" style="margin-left: 72px;"><a
                        href="#">免費註冊</a></span>
                <span class="psw" onclick="document.getElementById('id01').style.display='none';
                  alertMsg('新密碼已寄送至您的手機, 請重新登入!')">
                    <a href="#">忘記密碼?</a></span>

            </div>
        </form>
    </div>

    <!-- 註冊會員 -->
    <div id="id02" class="modal">
        <form class="modal-content animate" style="width: 350px;" action="/action2_page.php" method="post">
            <div class="imgcontainer">
                <span onclick="document.getElementById('id02').style.display='none'" class="close"
                    title="Close Modal">&times;</span>
                <div class="contant02" style="font-size:25px;">註冊會員</div>
            </div>

            <div class="container">
                <label for="uid"><b>姓名</b></label>
                <span class="ipit"><input type="text" placeholder="請輸入真實姓名" name="uid" required></span>

                <label for="cellpone"><b>手機號碼</b></label>
                <span class="ipt"><input type="text" placeholder="請輸手機號碼" name="cellphone" required></span>

                <label for="uname"><b>帳號</b></label>
                <span class="ipt"><input type="text" placeholder="請輸入帳號" name="uname" required></span>

                <label for="psw"><b>設定密碼</b></label>
                <span class="ipt"><input type="password" placeholder="請輸入密碼" id="psw" required></span>

                <label for="pswconfirm"><b>密碼確定</b></label>
                <span class="ipt"><input type="password" placeholder="請再次輸入密碼" id="pswconfirm" required></span>

                <span class="btn03" onclick="checkPassword()"><button type="submit" class="sign">立即註冊</button></span>
            </div>

            <div class="container" style="background-color:#dddd; ">
                <button type="button" onclick="document.getElementById('id02').style.display='none'"
                    class="cancelbtn">取消註冊</button>
            </div>
        </form>
    </div>




    <script>
        var curProd = null;
        /*暫定資料*/
        /* 以下是後端傳來的JSON Object的格式, 這些資料定義在前端用來測試用 */
        var Prod2001 = {
            "uid": "2001",
            "ProdPic": "cake1.jpg",
            "Title": "香檸卡士達草莓盒",
            "Price": "300",
            "Info": "黑手甜點-季節限定 添加檸檬生乳卡士達的進化版本--檸香卡士達草莓盒",
            "ExpiredDate": "保存期限：冷藏一周",
            "CommentAry": [{
                "Pic": "customer1.jpg",
                "Name": "今晚吃雞",
                "Date": "2020/10/3",
                "StarCount": "4",
                "Comment": "不膩，很香甜"
            },
            {
                "Pic": "customer2.jpg",
                "Name": "黃海",
                "Date": "2020/12/30",
                "StarCount": "3",
                "Comment": "讚，值得推薦!"
            },
            {
                "Pic": "customer3.jpg",
                "Name": "大王叫我來巡山",
                "Date": "2020/12/13",
                "StarCount": "5",
                "Comment": "非常好吃的點心，大小也適中，賣相佳"
            }],
            "RefProdAry": [{
                "uid": "2002",
                "Pic": "cake2.jpg",
                "Name": "草莓蛋糕"
            },
            {
                "uid": "2003",
                "Pic": "cake3.jpg",
                "Name": "巧克力蛋糕"
            },
            {
                "uid": "2004",
                "Pic": "cake4.jpg",
                "Name": "草莓綠茶蛋糕"
            },
            {
                "uid": "2005",
                "Pic": "cake5.jpg",
                "Name": "香草派"
            },
            {
                "uid": "2006",
                "Pic": "cake6.jpg",
                "Name": "巧克力布丁"
            },
            {
                "uid": "2007",
                "Pic": "cake7.jpg",
                "Name": "巧克力餅干盒"
            },
            {
                "uid": "2008",
                "Pic": "cake8.jpg",
                "Name": "鹹蛋黃餅乾乳酪蛋糕"
            },
            {
                "uid": "2009",
                "Pic": "cake9.jpg",
                "Name": "烏龍鐵觀音重乳酪蛋糕"
            }

            ]
        }

        var Prod2002 = {
            "uid": "2002",
            "ProdPic": "cake2.jpg",
            "Title": "草莓蛋糕",
            "Price": "300",
            "Info": "檸檬生乳卡士達的進化版本--檸香卡士達草莓盒",
            "ExpiredDate": "保存期限：常溫五天/冷藏七日",
            "CommentAry": [
                {
                    "Pic": "customer3.jpg",
                    "Name": "陳丁發",
                    "Date": "2020/11/30",
                    "StarCount": "5",
                    "Comment": "讚, 很香甜!"
                },
                {
                    "Pic": "customer4.jpg",
                    "Name": "乖小孩不說謊",
                    "Date": "2020/4/20",
                    "StarCount": "3",
                    "Comment": "還算好吃!"
                },
                {
                    "Pic": "customer5.jpg",
                    "Name": "靜靜我愛你",
                    "Date": "2020/1/13",
                    "StarCount": "5",
                    "Comment": "非常好吃, 讚!"
                }],
            "RefProdAry": [
                {
                    "uid": "2002",
                    "Pic": "cake2.jpg",
                    "Name": "草莓蛋糕"
                },
                {
                    "uid": "2003",
                    "Pic": "cake3.jpg",
                    "Name": "巧克力蛋糕"
                },
                {
                    "uid": "2004",
                    "Pic": "cake4.jpg",
                    "Name": "草莓綠茶蛋糕"
                },
                {
                    "uid": "2005",
                    "Pic": "cake5.jpg",
                    "Name": "香草派"
                },
                {
                    "uid": "2006",
                    "Pic": "cake6.jpg",
                    "Name": "巧克力布丁"
                }]
        };

        var Prod2003 = {
            "uid": "2003",
            "ProdPic": "cake3.jpg",
            "Title": "巧克力蛋糕",
            "Price": "600",
            "Info": "先苦後甘的滋味~不只髒你手",
            "ExpiredDate": "保存期限：冷藏12天",
            "CommentAry": [
                {
                    "Pic": "customer9.jpg",
                    "Name": "陳山河",
                    "Date": "2020/11/30",
                    "StarCount": "5",
                    "Comment": "讚, 真好吃!"
                },
                {
                    "Pic": "customer2.jpg",
                    "Name": "Vivian",
                    "Date": "2020/6/23",
                    "StarCount": "4",
                    "Comment": "名不虛傳, 好棒!"
                },
                {
                    "Pic": "customer5.jpg",
                    "Name": "愛吃貓的魚",
                    "Date": "2020/12/13",
                    "StarCount": "4",
                    "Comment": "非常好吃, 讚!"
                }],
            "RefProdAry": [
                {
                    "uid": "2004",
                    "Pic": "cake2.jpg",
                    "Name": "草莓蛋糕"
                },
                {
                    "uid": "2007",
                    "Pic": "cake3.jpg",
                    "Name": "巧克力蛋糕"
                },
                {
                    "uid": "2009",
                    "Pic": "cake4.jpg",
                    "Name": "草莓綠茶蛋糕"
                },
                {
                    "uid": "2004",
                    "Pic": "cake5.jpg",
                    "Name": "香草派"
                },
                {
                    "uid": "2007",
                    "Pic": "cake6.jpg",
                    "Name": "巧克力布丁"
                }]
        };

        var prodAry = new Array();
        prodAry.push(Prod2001);
        prodAry.push(Prod2002);
        prodAry.push(Prod2003);

        function getUrlQueryParams(url) {
            var queryString = url.split("?")[1];
            if (queryString == undefined) {
                return undefined;
            }

            var keyValuePairs = queryString.split("&");
            var keyValue = [];
            var queryParams = {};
            keyValuePairs.forEach(function (pair) {
                keyValue = pair.split("=");
                queryParams[keyValue[0]] = decodeURIComponent(keyValue[1]).replace(/\+/g, " ");
            });

            return queryParams;
        }

        window.onload = function () {
            // 檢查URL上有否帶入ProdUid(例: uid=2001) 的字串串
            var param = getUrlQueryParams(window.location.href);

            if (param == undefined || param.uid == undefined) {
                updateProdInfo(1, 2001);  // default product info
            } else {
                updateProdInfo(1, param.uid);  // default product info
            }

        }

        /*這個FUNCTION要有SERVER才可以從後端要資料 
        function updateProdInfo(type, uid) { 
			var xhr = new XMLHttpRequest();  // 發REQUEST到後端要資料
            
            xhr.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) { // 成功, 資料有回來
                    console.log("Response=" + this.responseText);
                    
                	var strCurProd = this.responseText;  // SERVER回來的資料
                    curProd = JSON.parse(strCurProd);  // 將字串轉成JSON OBJECT並指定給curProd
                   
                    displayProdInfo();
                }
            };
            
            var dataObj = {"ReqType": "1", "ProdUid" : "2001"};  // default
            dataObj.ReqType = type;
            dataObj.ProdUid = uid;
            var data = JSON.stringify(dataObj);
            xhr.open("POST", "http://localhost:8080/CakeServer/CakeServlet", true);
            xhr.send(data);
        }
        */

        /*這個FUNCTION不用SERVER, 資料定義在前端, 直接指定給curProd */
        function updateProdInfo(type, uid) {

            var idx = (parseInt(uid) % 3);
            curProd = prodAry[idx]; /* 直接指定測試資料 */

            displayProdInfo();
        }


        function displayProdInfo() {
            document.getElementById("pProdTitle").innerHTML = curProd.Title;
            document.getElementById("pProdInfo").innerHTML = curProd.Info;
            document.getElementById("pPrice").innerHTML = "NT$ " + curProd.Price;
            document.getElementById("pExpiredDate").innerHTML = "保存日期: " + curProd.ExpiredDate;
            document.getElementById("imgProd").src = "images/" + curProd.ProdPic;

            // 顯示所有評語
            var aryComments = curProd.CommentAry;

            var strPerComm = "";
            for (var i = 0; i < aryComments.length; i++) {
                var info = aryComments[i];

                strPerComm += "<div class='divRow'> <img  src='images/";
                strPerComm += info.Pic + "' height='30px' width='30px' align='left'><pre>";
                strPerComm += info.Name + "      時間: " + info.Date + "     商品評價: </pre>";
                var countStar = parseInt(info.StarCount);
                for (var j = 0; j < countStar; j++) {
                    strPerComm += "<img  src='images/star2.png' align='center' width='20px' height='20px'>";
                }

                if (countStar < 5) {
                    for (var k = 0; k < 5 - countStar; k++) {
                        strPerComm += "<img  src='images/star1.png' align='center' width='20px' height='20px'>";
                    }
                }

                strPerComm += "</div><p style='margin-left: 50px;'>評語: " + info.Comment + "</p>";
                strPerComm += "<div class='divLine'></div>";

                document.getElementById("divComments").innerHTML = strPerComm;
            }

            displayRefProd();
        }

        class BuyItem {
            constructor(uid, img, name, price, count) {
                this.uid = uid;
                this.img = img;
                this.price = price;
                this.count = count;
            }
        }





        // 購物車
        var shoppingCart = new Array();
        shoppingCart.push(new BuyItem(1001, "images/item1", "物品1", 100, 1));
        shoppingCart.push(new BuyItem(1002, "images/item2", "物品2", 200, 1));

        function addShoppingItem(item) {
            shoppingCart.push(item);
        }

        // 密碼驗證
        function checkPassword() {
            if (document.getElementById("psw").value !=
                document.getElementById("pswconfirm").value) {
                alert("驗證密碼失敗!，請重新輸入!")
            }


        }

        //  show alert message
        function alertMsg(msg) {
            alert(msg);
        }

        // Sidenav(側拉菜單)
        function openNav() {
            document.getElementById("mySidepanel").style.width = "200px";
        }

        function closeNav() {
            document.getElementById("mySidepanel").style.width = "0";
        }

        var dropdown = document.getElementsByClassName("dropdown-btn");
        var i;

        //Dropdown Menu in Sidenav(Sidenav中的下拉菜單)
        for (i = 0; i < dropdown.length; i++) {
            dropdown[i].addEventListener("click", function () {
                this.classList.toggle("active");
                var dropdownContent = this.nextElementSibling;
                if (dropdownContent.style.display === "block") {
                    dropdownContent.style.display = "none";
                } else {
                    dropdownContent.style.display = "block";
                }
            });
        }

        // Clickable Dropdown(點擊菜單)
        function myFunction() {
            document.getElementById("myDropdown").classList.toggle("show");
        }

        window.onclick = function (event) {
            if (!event.target.matches('.dropbtn')) {
                var dropdowns = document.getElementsByClassName("dropdown-content");
                var i;
                for (i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }







        /*>>>>>>>>>>>>>本頁內容+格式*/

        $(document).ready(function () {
            $.spin.imageBasePath = './spinbutton/img/spin1/';

            $('#spnbut').spin({
                min: 1,
                max: 99,
                changed: function (n, o) {
                    console.log("TEMP>>>spin button: v=" + n);
                }
            });

        });

        // 全域變數
        var curRefProdIdx = parseInt(0);


        /* 後端傳來的JSON Object
        var curProd = {
            "ProdPic": "cake1.jpg",
            "Title": "香檸卡士達草莓盒",
            "Price": "300",
            "Info": "黑手甜點-季節限定 添加檸檬生乳卡士達的進化版本--檸香卡士達草莓盒",
            "ExpiredDate": "2021/2/1",
            CommentAry: [{
                "Pic": "customer1.jpg",
                "Name": "陳文",
                "Date": "2020/10/3",
                "StarCount": "4",
                "Comment": "不膩，很香甜"
            },
            {
                "Pic": "customer2.jpg",
                "Name": "黃海",
                "Date": "2020/12/30",
                "StarCount": "3",
                "Comment": "讚，值得推薦!"
            },
            {
                "Pic": "customer3.jpg",
                "Name": "阿貓",
                "Date": "2020/12/13",
                "StarCount": "5",
                "Comment": "非常好吃的點心，大小也適中，賣相佳"
            }],
            RefProdAry: [{
                "Pic": "cake2.jpg",
                "Name": "草莓蛋糕"
            },
            {
                "Pic": "cake3.jpg",
                "Name": "巧克力蛋糕"
            },
            {
                "Pic": "cake4.jpg",
                "Name": "草莓綠茶蛋糕"
            },
            {
                "Pic": "cake5.jpg",
                "Name": "香草派"
            },
            {
                "Pic": "cake6.jpg",
                "Name": "巧克力布丁"
            },
            {
                "Pic": "cake7.jpg",
                "Name": "巧克力餅干盒"
            },
            {
                "Pic": "cake8.jpg",
                "Name": "鹹蛋黃餅乾乳酪蛋糕"
            },
            {
                "Pic": "cake9.jpg",
                "Name": "烏龍鐵觀音重乳酪蛋糕"
            }

            ]
        }

        var strCurProd = JSON.stringify(curProd);

        window.onload = function () {
            document.getElementById("pProdTitle").innerHTML = curProd.Title;
            document.getElementById("pProdInfo").innerHTML = curProd.Info;
            document.getElementById("pPrice").innerHTML = "NT$ " + curProd.Price;
            document.getElementById("pExpiredDate").innerHTML = curProd.ExpiredDate;

            // 顯示所有評語
            var aryComments = curProd.CommentAry;

            var strPerComm = "";
            for (var i = 0; i < aryComments.length; i++) {
                var info = aryComments[i];

                strPerComm += "<div class='divRow'> <img  src='images/";
                strPerComm += info.Pic + "' height='30px' width='30px' align='left'><pre>";
                strPerComm += info.Name + "      時間: " + info.Date + "     商品評價: </pre>";
                var countStar = parseInt(info.StarCount);
                for (var j = 0; j < countStar; j++) {
                    strPerComm += "<img  src='images/star2.png' align='center' width='20px' height='20px'>";
                }

                if (countStar < 5) {
                    for (var k = 0; k < 5 - countStar; k++) {
                        strPerComm += "<img  src='images/star1.png' align='center' width='20px' height='20px'>";
                    }
                }

                strPerComm += "</div><p style='margin-left: 50px;'>評語: " + info.Comment + "</p>";
                strPerComm += "<div class='divLine'></div>";

                document.getElementById("divComments").innerHTML = strPerComm;
            }

            displayRefProd();
        }*/

        function displayRefProd(x) {
            // 顯示所有參考商品
            var aryRefProd = curProd.RefProdAry;

            var strRefProd = "";

            var countRefProd = aryRefProd.length;

            if (x == "R") {
                if (curRefProdIdx > 0) {
                    curRefProdIdx -= 6;
                }
            } else {
                if (curRefProdIdx == countRefProd) {
                    return;
                }
            }

            for (var i = 0; i < 5; i++) {  // 參考商品最多顯示6個
                var info = aryRefProd[curRefProdIdx];
                curRefProdIdx++;

                if (i == 5 || curRefProdIdx == countRefProd) {
                    if (curRefProdIdx == countRefProd) {
                        curRefProdIdx = 0;
                    }

                    break;
                }

                strRefProd += "<div><img  src='images/" + info.Pic + "' width='180px' height='180px' onclick='updateProdInfo(1, " + info.uid + ")'>";
                strRefProd += "<span>" + info.Name + "</span></div>";
            }

            document.getElementById("divRefImg").innerHTML = strRefProd;
        }

        function doShopping() {
            var strItem = '{"uid" : "' + curProd.uid + '",' +
                '"img" : "images/' + curProd.ProdPic + '",' +
                '"name" : "' + curProd.Title + '",' +
                '"price" : "' + curProd.Price + '",' +
                '"count" : "' + document.getElementById("spnbut").value + '"}';
            var itemObj = JSON.parse(strItem);

            var items = localStorage.getItem("ShopCart");
            var aryItems;

            if (items == undefined) {
                aryItems = new Array();
            } else {
                aryItems = JSON.parse(items);
            }

            aryItems.push(itemObj);
            localStorage.setItem("ShopCart", JSON.stringify(aryItems));
        }
    </script>
</head>

<body>

    <h1 style="font-size: 32pt ;position: absolute;top: 11%; left: 44%;">商品資訊</h1>
    <img src="images/line57.png" width="93%" style="position: absolute;top:18%;left:4%;z-index: -23;">


    <div class="divTop">
        <div class="divProd1">
            <img id="imgProd" height="92%" width="92%">
            <p align="center" id="pExpiredDate" style="position: relative;left: 155%;top:-5%;"></p>
        </div>
        <div class="divProd2">
            <p id="pProdTitle"></p>
            <p id="pProdInfo"></p>
            <p id="pPrice"></p>
            <label id="lblAmount">購買數量</label>
            <input type="number" id="spnbut" size="3" value="1" width="50px" height="130px">
            <p style="position: relative;left: 51%; top: -11%; width: 600px;">新站營運! 所有消費者皆享95折優惠<br>註冊本站會員，即可享受運費0元!</p>
            <br>
            <div class="revisionbut">
                <a href="../shopcart3/購物車.html"><button id="butOrder1">直接購買</button></a>&nbsp;&nbsp;<button id="butOrder2"
                    onclick="doShopping()">加入購買車</button>
            </div>
        </div>
    </div>



    <h2 id="hComments1">商品評價區</h2>
    <div class="commentborder">


        <div id="divComments">
            <!--用來填評價的區域 -->
        </div>
    </div>

    <h2 id="hComments2">商品推薦區</h2>
    <hr width="95%" size="2" style="position: absolute; top: 227%; left: 2.5%;background-color: black;">


    <div class="divRefProd">

        <button id="butLeftArw" onclick="displayRefProd('R')">&laquo;</button>
        <button id="butRightArw" onclick="displayRefProd('L')">&raquo;</button>

        <span>
            <div id="divRefImg">
                <!--用來填參考商品的區域 -->
            </div>
            <br>


        </span>
    </div>
</body>

<footer>
    <div>
    <img src="images/262312.jpg" width="75" height="75" style="position: relative; top: 24%;left: 730%;">
    </div>
    <div class="foot-text">
        服務時間：周一至周五11:00~17:50<br>
        聯絡資訊：(03)9921-8847<br>
        地址：桃園市中壢區普忠里中北路200號<br>
    </div>
    <font style="align-items:center; color:white; position: absolute; top: 80%; left: 40%;">CYCUIM_20210109&copy; D33
        All
        Rights Reserved.</font>
</footer>

</html>