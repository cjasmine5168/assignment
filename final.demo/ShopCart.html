<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>購物車</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link href="css/shopcar.css" rel="stylesheet" type="text/css">
	<link rel="icon" href="images/cake51.png">


	<div id="mySidepanel" class="sidepanel">
		<a href="#" class="closebtn"
			onclick="closeNav()">×</a>
		<a href="Index.html">首頁</a>
		<button class="dropdown-btn">商品分類<i class="fa fa-caret-down"></i></button>
		<div class="dropdown-container">
            <a href="ProdList.html">所有商品</a>
            <a href="ProdList.html?cat=2">蛋糕</a>
            <a href="ProdList.html?cat=3">塔類</a>
            <a href="ProdList.html?cat=4">餅乾</a>
            <a href="ProdList.html?cat=5">常溫點心</a>
          </div>
		<a href="#">促銷活動</a>
		<a href="#">常見問題</a>
		<a href="#">關於我們</a>
	</div>

	<button class="openbtn" onclick="openNav()">☰ </button>

	<div class="img2-header">
		<div class="dropdown">
			<img onclick="myFunction()" class="dropbtn" src="images/images.png" width="45px" height="45"
				title="會員專區"></img>
			<div id="myDropdown" class="dropdown-content">
				<a href="#" style="padding: 12px 16px; ">
					<span onclick="document.getElementById('id01').style.display='block'">登入</span>
				</a>

				<a href="#" style="padding: 12px 16px; ">
					<span
						onclick="document.getElementById('id02').style.display='block'">註冊&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</span>
				</a>

				<a href="#">個人資料修改</a>
				<a href="#">訂單紀錄</a>
				<a href="#">登出</a>
			</div>
		</div>
	</div>
	<div class="img1-header">
		<a href="#"><img src="images/shopcart2.png" width="50" height="50" title="購物車"> </a>
	</div>

	<!-- 會員登入 -->
	<div id="id01" class="modal">
		<form class="modal-content animate" style="width: 350px;" action="/action1_page.php" method="post">
			<div class="imgcontainer">
				<span onclick="document.getElementById('id01').style.display='none'" class="close"
					title="Close Modal">&times;</span>
				<div class="contant02" style="font-size:25px;">會員登入</div>
			</div>

			<div class="container">
				<label for="uname"><b>帳號</b></label>
				<span class="ipt"><input type="text" placeholder="輸入帳號" name="uname" required></span>

				<label for="psw"><b>密碼</b></label>
				<span class="ipt"><input type="password" placeholder="輸入密碼" name="psw" required></span>

				<span class="btn02"><button type="submit" class="sign">登入</button></span>
				<label>
					<span class="ipt"><input type="checkbox" checked="checked" name="remember">記住我的帳號</span>
				</label>
			</div>

			<div class="container" style="background-color:#dddd; ">
				<button type="button" onclick="document.getElementById('id01').style.display='none'"
					class="cancelbtn">取消</button>
				<span onclick="document.getElementById('id01').style.display='none'; 
				document.getElementById('id02').style.display='block'" class="register" style="margin-left: 72px;"><a
						href="#">免費註冊</a></span>
				<span class="psw" onclick="document.getElementById('id01').style.display='none';
					alertMsg('新密碼已寄送至您的手機, 請重新登入!')">
					<a href="#">忘記密碼?</a></span>

			</div>
		</form>
	</div>

	<!-- 註冊會員 -->
	<div id="id02" class="modal">
		<form class="modal-content animate" style="width: 350px;" action="/action2_page.php" method="post">
			<div class="imgcontainer">
				<span onclick="document.getElementById('id02').style.display='none'" class="close"
					title="Close Modal">&times;</span>
				<div class="contant02" style="font-size:25px;">註冊會員</div>
			</div>

			<div class="container">
				<label for="uid"><b>姓名</b></label>
				<span class="ipit"><input type="text" placeholder="請輸入真實姓名" name="uid" required></span>

				<label for="cellpone"><b>手機號碼</b></label>
				<span class="ipt"><input type="text" placeholder="請輸手機號碼" name="cellphone" required></span>

				<label for="uname"><b>帳號</b></label>
				<span class="ipt"><input type="text" placeholder="請輸入帳號" name="uname" required></span>

				<label for="psw"><b>設定密碼</b></label>
				<span class="ipt"><input type="password" placeholder="請輸入密碼" id="psw" required></span>

				<label for="pswconfirm"><b>密碼確定</b></label>
				<span class="ipt"><input type="password" placeholder="請再次輸入密碼" id="pswconfirm" required></span>

				<span class="btn03" onclick="checkPassword()"><button type="submit" class="sign">立即註冊</button></span>
			</div>

			<div class="container" style="background-color:#dddd; ">
				<button type="button" onclick="document.getElementById('id02').style.display='none'"
					class="cancelbtn">取消註冊</button>
			</div>
		</form>
	</div>

	<script>
		var BuyItem1 = {
			"uid" : "1001",
			"img" : "images/item1",
			"name" : "物品1",
			"price" : "100",
			"count" : "1"
		}

		var BuyItem2 = {
			"uid" : "1002",
			"img" : "images/item2",
			"name" : "物品2",
			"price" : "200",
			"count" : "2"
		}

		// 購物車
		/*
		shoppingCart.push(BuyItem1);
		shoppingCart.push(BuyItem2);

		var test = JSON.stringify(shoppingCart);
		console.log(test);*/

		function addShoppingItem(item) {
			shoppingCart.push(item);
		}

		// 密碼驗證
		function checkPassword() {
			if (document.getElementById("psw").value !=
				document.getElementById("pswconfirm").value) {
				alert("驗證密碼失敗!，請重新輸入!")
			}


		}

		//  show alert message
		function alertMsg(msg) {
			alert(msg);
		}

		// Sidenav(側拉菜單)
		function openNav() {
			document.getElementById("mySidepanel").style.width = "200px";
		}

		function closeNav() {
			document.getElementById("mySidepanel").style.width = "0";
		}

		var dropdown = document.getElementsByClassName("dropdown-btn");
		var i;

		//Dropdown Menu in Sidenav(Sidenav中的下拉菜單)
		for (i = 0; i < dropdown.length; i++) {
			dropdown[i].addEventListener("click", function () {
				this.classList.toggle("active");
				var dropdownContent = this.nextElementSibling;
				if (dropdownContent.style.display === "block") {
					dropdownContent.style.display = "none";
				} else {
					dropdownContent.style.display = "block";
				}
			});
		}

		// Clickable Dropdown(點擊菜單)
		function myFunction() {
			document.getElementById("myDropdown").classList.toggle("show");
		}

		window.onclick = function (event) {
			if (!event.target.matches('.dropbtn')) {
				var dropdowns = document.getElementsByClassName("dropdown-content");
				var i;
				for (i = 0; i < dropdowns.length; i++) {
					var openDropdown = dropdowns[i];
					if (openDropdown.classList.contains('show')) {
						openDropdown.classList.remove('show');
					}
				}
			}
		}
	</script>







	<!----購物車內容(本頁)-->
	<script src="spinbutton/js/jquery-1.4.4.min.js"></script>
	<script src="spinbutton/js/jquery-spin.js"></script>
	<script>
		class ShoppingItem {
			constructor(uid, img, name, price, count) {
				this.uid = uid;
				this.img = img;
				this.name = name;
				this.price = price;
				this.count = count;
			}
		}

		var aryItems = null;

		// 從後端的資料並call function填入
		//aryItems.push(new ShoppingItem(1001, 'images/image1.jpg', '商品1', 100, 1));
		//aryItems.push(new ShoppingItem(1002, 'images/image2.jpg', '商品2', 100, 2));

		var shipFee = 40;  //運費
		var discountRate = 0.05; // 會員折扣

		$(document).ready(function () {
			$.spin.imageBasePath = './spinbutton/img/spin1/';

			var strItems = localStorage.getItem("ShopCart");

			if(strItems == null) {
				aryItems = new Array()
			} else {
				aryItems = JSON.parse(strItems);
			}

			var count = addShoppingItems();
			for (var i = 0; i < count; i++) {
				$('#spn' + i).spin({
					min: 1,
					max: 99,
					changed: function (n, o) {
						var idx = this.context.parentNode.parentNode.rowIndex;
						aryItems[idx - 1].count = n;   // update item count
						displaySum();
					}
				});
			}
		});

		function itemChecked() {
			var allChecked = true;

			var items = document.getElementsByName("chkbox-item");
			for (var i = 0; i < items.length; i++) {
				var item = aryItems[i];

				if (items[i].checked == false) {
					allChecked = false;
					break;
				}
			}

			if (allChecked == true) {
				document.getElementById("chkbox-all").checked = true;
			} else {
				document.getElementById("chkbox-all").checked = false;
			}

			displaySum();
		}

		function addShoppingItems() {

			document.getElementById("checkout").innerText = "結帳(" + aryItems.length + ")";

			for (var x = 0; x < aryItems.length; x++) {
				var newRow = document.getElementById('sctable').insertRow();
				var newCell = newRow.insertCell();
				newCell.innerHTML = "<tr><td align='center'><input type='checkbox' name='chkbox-item' onclick='itemChecked()'></td></tr>";


				var item = aryItems[x];
				total += (item.price * item.count);
				var newCell = newRow.insertCell();
				newCell.innerHTML = "<tr><td><p>" + item.uid + "</p></td></tr>";

				newCell = newRow.insertCell();
				newCell.innerHTML = "<tr><td><img align='center' src='" + item.img + "' border=2 height=60 width=100 >"+ item.name + "</td></tr>";

				newCell = newRow.insertCell();
				newCell.innerHTML = "<tr><td><p>" + item.price + "</p></td></tr>";

				newCell = newRow.insertCell();
				newCell.innerHTML = "<tr><td><input type='input' id='spn" + x + "' size='2' value='" + item.count + "' /></td></tr>";

				newCell = newRow.insertCell();
				newCell.innerHTML = "<tr><td><img style='display:block; margin-left:auto; margin-right:auto; width:50%;' " +
					"src='./images/remove.png' width='30' height='30'  onclick='removeRow(" + x + ", this)'></td></tr>";
			}


			// set all checkbox checked
			document.getElementById("chkbox-all").checked = true;
			var items = document.getElementsByName("chkbox-item");
			for (var i = 0; i < items.length; i++) {
				items[i].checked = true;
			}

			displaySum();

			return x;
		}

		function removeRow(x, o) {
			var idx = o.parentNode.parentNode.rowIndex;

			document.getElementById("sctable").deleteRow(idx);  // 將項目從TABLE中移除
			aryItems.splice(idx - 1, 1);  // 將項目從購物ARRAY中移除

			localStorage.setItem("ShopCart", JSON.stringify(aryItems));

			displaySum();
		}

		function displaySum() {
			var curTotal = 0;
			var curDiscount = 0;
			var count = 0;

			// 找出有勾選的項目
			var items = document.getElementsByName("chkbox-item");
			for (var i = 0; i < items.length; i++) {  // 計算總價和件數
				var item = aryItems[i];

				if (items[i].checked == true) {
					curTotal += (item.price * item.count);
					count++;
				}
			}

			// 顯示購買筆數於結帳按鈕
			document.getElementById("checkout").innerText = "結帳(" + count + ")";

			if (count == 0) {
				document.getElementById("total").innerHTML = "運費: $0		商品總金額: $0" +
					"		活動共折抵: $0		結帳總金額: $0 (未選擇任何商品)";
				return;
			}

			if (document.getElementById("chkbox-member").checked == true) {

				if (document.getElementById("chkbox-freeship").checked == true) {
					curDiscount = (curTotal * discountRate) + shipFee;
					curShipFee = 0;
				} else {
					curDiscount = (curTotal * discountRate);
					curShipFee = 40;
				}
			} else {
				if (document.getElementById("chkbox-freeship").checked == true) {
					curDiscount = shipFee;
					curShipFee = 0;
				} else {
					curDiscount = 0;
					curShipFee = 40;
				}

			}

			document.getElementById("total").innerHTML = "運費: $" + curShipFee + "		商品總金額: $" + curTotal +
				"		活動共折抵: $" + curDiscount + "		結帳總金額: $" + (curTotal + shipFee - curDiscount);

		}

		function selectAll() {

			var items = document.getElementsByName("chkbox-item");
			var chkboxAll = document.getElementById("chkbox-all");

			for (var i = 0; i < items.length; i++) {
				if (chkboxAll.checked == true) {
					items[i].checked = true;
				} else {
					items[i].checked = false;
				}
			}

			displaySum();
		}

		function doCheckout() {
			localStorage.removeItem("ShopCart");
		}

	</script>
</head>

<body>

	<div class="scdiv" style="height: auto;display:block; margin-top: 100px;">
		<h1 align="center">購物清單</h1>

		<div style="display:block; width: 100%;margin:0 auto; height: auto;">
			<table id="sctable" style="width: 95% ;left: 2.5%;text-align: center;">
				<colgroup>
					<col span="1" style="width: 5%; ">
					<col span="1" style="width: 10%;">
					<col class="goods" span="1" style="width: 40%;">
					<col span="1" style="width: 10%;">
					<col span="1" style="width: 8%;">
					<col span="1" style="width: 4%">
				</colgroup>

				<tr>
					<th><input type="checkbox" id="chkbox-all" onclick="selectAll()"></th>
					<th>商品編號</th>
					<th>商品內容</th>
					<th>單價</th>
					<th>數量</th>
					<th>移除</th>
				</tr>
				
			</table>
		</div>

		<div style="display:block; width: 100%; margin:0 auto;">
			<pre style="padding-left: 150px; font-size: 20px;" id="total"></pre>
		</div>	
		
		<div style="width: 100%;display:block; width: 100%; margin:0 auto;left: 3%;">
			<input type="checkbox" id="chkbox-member" onclick="displaySum()"><label>我是會員，享有折扣5%</label><br />
			<input type="checkbox" id="chkbox-freeship" onclick="displaySum()"><label>歡樂佳節，享有免運費</label>

		</div>

		<div style="width: 100%; display:block; width: 100%; margin-left: 80%;">
			<p>
				<a href="TxDetails.html"><button id="checkout" style="font-size: 20px; width: 100px; background-color: #4CAF50; border-radius: 5px ;
			 " type="button" class="swd-button" onclick="doCheckout()"></button></a>
				<a href="ProdList.html"> <button style="font-size: 20px;border-radius: 5px ;" type="button" class="swd-button">繼續購物</button></a>
			</p>
		</div>
	</div>


</body>
<footer>
	<div>
	</div>
	<div class="foot-text">
		服務時間：周一至周五11:00~17:50<br>
		聯絡資訊：(03)9921-8847<br>
		地址：桃園市中壢區普忠里中北路200號<br>
	</div>
	<font style="align-items:center; color:white; position: absolute; top: 80%; left: 40%;">CYCUIM_20210109&copy; D33
		All
		Rights Reserved.</font>
</footer>